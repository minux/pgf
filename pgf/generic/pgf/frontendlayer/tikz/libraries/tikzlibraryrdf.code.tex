% Copyright 2016 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header: /cvsroot/pgf/pgf/generic/pgf/frontendlayer/tikz/libraries/tikzlibraryrdf.code.tex,v 1.2 2016/03/05 20:58:47 tantau Exp $


\newif\iftikz@rdf@on

\def\tikz@add@rdf@option#1{\iftikz@rdf@on\expandafter\def\expandafter\tikz@rdf@options\expandafter{\tikz@rdf@options#1}\fi}

\tikzset{
  rdf/.cd,
  .code=\pgfqkeys{/tikz/rdf}{#1},
  on/.code=\tikz@rdf@ontrue,
  off/.code=\tikz@rdf@onfalse,
  vocab/.code=\tikz@add@rdf@option{\pgfrdfvocab{#1}},
  prefix/.code=\tikz@add@rdf@option{\pgfrdfprefix{#1}},
  subject is cuiri/.code=\tikz@add@rdf@option{\def\tikz@rdf@subject{#1}},
  subject is name/.code=\tikz@add@rdf@option{\pgfidrefprevuse\tikz@rdf@the@id{#1}\edef\tikz@rdf@subject{\tikzrdfhashmark\tikz@rdf@the@id}},
  subject is scope name/.code=\tikz@add@rdf@option{%
    \ifx\tikz@id@name\pgfutil@empty%
      \def\tikz@id@name{@rdf}%
    \fi%
    \pgfidrefnextuse\tikz@rdf@the@id{\tikz@id@name}\edef\tikz@rdf@subject{\tikzrdfhashmark\tikz@rdf@the@id}},
  predicate is cuiri/.code=\tikz@add@rdf@option{\edef\tikz@rdf@predicate{\tikz@rdf@predicate,#1}},
  predicate is name/.code=\tikz@add@rdf@option{\pgfidrefprevuse\tikz@rdf@the@id{#1}\edef\tikz@rdf@predicate{\tikz@rdf@predicate,\tikzrdfhashmark\tikz@rdf@the@id}},
  object is cuiri/.code=\tikz@add@rdf@option{\def\tikz@rdf@object{#1}\let\tikz@rdf@object@literal\relax},
  object is name/.code=\tikz@add@rdf@option{\pgfidrefprevuse\tikz@rdf@the@id{#1}\edef\tikz@rdf@object{\tikzrdfhashmark\tikz@rdf@the@id}\let\tikz@rdf@object@literal\relax},
  object is literals/.code=\tikz@add@rdf@option{\let\tikz@rdf@object\relax\def\tikz@rdf@object@literal{#1}},
  make statement triple/.code=\tikz@add@rdf@option{{\tikz@clear@rdf@options\pgfqkeys{/tikz/rdf}{#1}\tikz@do@rdf@options\tikz@rdf@make@triple}},
  make statement about scope content/.code=\tikz@add@rdf@option{\def\tikz@rdf@invoke@code{\tikz@clear@rdf@options\pgfqkeys{/tikz/rdf}{#1}\tikz@do@rdf@options\tikz@rdf@make@content@triple}},
}

\let\tikz@rdf@subject\relax
\let\tikz@rdf@predicate\pgfutil@empty
\let\tikz@rdf@object\relax
\let\tikz@rdf@object@literal\relax


{
  \catcode`\#=11
  \gdef\tikzrdfhashmark{#}
}


\def\tikz@rdf@make@triple{%
  \ifx\tikz@rdf@subject\relax\else%
    \ifx\tikz@rdf@predicate\relax\else%
      \ifx\tikz@rdf@object\relax%
        \ifx\tikz@rdf@object@literal\relax\else%
          {%
            \expandafter\pgfrdfabout\expandafter{\tikz@rdf@subject}%
            \foreach \tikz@rdf@pred in \tikz@rdf@predicate{%
              \ifx\tikz@rdf@pred\pgfutil@empty\else%
                \expandafter\pgfrdfproperty\expandafter{\tikz@rdf@pred}%
              \fi%
            }%
            \expandafter\pgfrdfcontent\expandafter{\tikz@rdf@object@literal}%
            \pgfidscope%
            \endpgfidscope%
          }%
        \fi%
      \else%
        {%
          \expandafter\pgfrdfabout\expandafter{\tikz@rdf@subject}%
          \foreach \tikz@rdf@pred in \tikz@rdf@predicate{%
            \ifx\tikz@rdf@pred\pgfutil@empty\else%
              \expandafter\pgfrdfproperty\expandafter{\tikz@rdf@pred}%
            \fi%
          }%
          \expandafter\pgfrdfresource\expandafter{\tikz@rdf@object}%
          \pgfidscope%
          \endpgfidscope%
        }%
      \fi%
    \fi%
  \fi%
}


\def\tikz@rdf@make@content@triple{%
  \ifx\tikz@rdf@subject\relax\else%
    \ifx\tikz@rdf@predicate\relax\else%
      \ifx\tikz@rdf@object@literal\relax\else%
        \expandafter\pgfrdfcontent\expandafter{\tikz@rdf@object@literal}%
      \fi%
      \expandafter\pgfrdfabout\expandafter{\tikz@rdf@subject}%
      \foreach \tikz@rdf@pred in \tikz@rdf@predicate{%
        \ifx\tikz@rdf@pred\pgfutil@empty\else%
          \expandafter\pgfrdfproperty\expandafter{\tikz@rdf@pred}%
        \fi%
      }%
    \fi%
  \fi%
}


\let\tikz@rdf@invoke@code\relax

\def\tikz@rdf@id@hook{%
  \tikz@rdf@invoke@code%
  \let\tikz@rdf@invoke@code\relax%
}

% Add hook:
\expandafter\def\expandafter\tikz@id@hook\expandafter{\tikz@id@hook\tikz@rdf@id@hook}



\endinput


